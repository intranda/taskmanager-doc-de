# 4.7. Internet Archive Download

Ein effizientes Harvesting des Internet Archive wird in Goobi ebenfalls durch die Zusammenarbeit mit dem intranda TaskManager möglich. Hierzu müssen zwei Voraussetzungen zunächst erfüllt sein. Das WebDavCommunicator-Plugin muss in dem Plugin-Ordner des TaskManagers vorliegen. Standardmäßig handelt es sich hierbei um folgenden Pfad:

```bash
/opt/digiverso/itm/plugins/WebDavCommunicator-<version>.jar
```

Das Plugin selbst wird ebenfalls in den Plugin-Ordner kopiert. Standardmäßig handelt es sich hierbei um folgenden Pfad:

```bash
/opt/digiverso/itm/plugins/IADownloadPlugin-<version>.jar
```

## Aufruf des Plugins

Der Aufruf des Internet-Archive-Harvestings wird innerhalb von Goobi in einem Workflowschritt folgendermaßen konfiguriert:

```bash
/usr/bin/java -jar /opt/digiverso/itm/bin/TaskClient.jar 
    -itm http:~/~/localhost/itm/service 
    -s http:~/~/archive.org/download/${meta.CatalogIDDigital} 
    -d {imagepath}/source/ 
    -n template 
    -e -i {stepid} 
    –T {processtitle} 
    -gid {processid} 
    -t IADOWNLOAD
```

## Parameter

Die innerhalb dieses Aufrufs zu übergebenen Parameter haben folgende Bedeutungen:

<table>
  <thead>
    <tr>
      <th style="text-align:left">Parameter</th>
      <th style="text-align:left">Mögliche Goobi Variable</th>
      <th style="text-align:left">Bedeutung</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align:left"><code>-itm</code>
      </td>
      <td style="text-align:left"><code>http://localhost/itm/service</code>
      </td>
      <td style="text-align:left">URL zur Schnittstelle des intranda TaskManagers</td>
    </tr>
    <tr>
      <td style="text-align:left"><code>-e</code>, <code>--returnError</code>
      </td>
      <td style="text-align:left">-</td>
      <td style="text-align:left">Wenn angegeben, beendet sich der TaskClient mit einem Fehlercode, um das
        automatische Fortschreiten im Workflow zu unterbinden</td>
    </tr>
    <tr>
      <td style="text-align:left"><code>-p</code>
      </td>
      <td style="text-align:left"><code>0 &#x2013; 10</code>
      </td>
      <td style="text-align:left">Priorität zur Verarbeitung dieses Jobs</td>
    </tr>
    <tr>
      <td style="text-align:left"><code>-gid</code>
      </td>
      <td style="text-align:left"><code>{processid}</code>
      </td>
      <td style="text-align:left">ID des Goobi-Vorgangs</td>
    </tr>
    <tr>
      <td style="text-align:left"><code>-i</code>
      </td>
      <td style="text-align:left"><code>{stepid}</code>
      </td>
      <td style="text-align:left">Die ID des Arbeitsschrittes, der den Aufruf startet</td>
    </tr>
    <tr>
      <td style="text-align:left"><code>-T</code>, <code>--title</code>
      </td>
      <td style="text-align:left"><code>{processtitle}</code>
      </td>
      <td style="text-align:left">Der Vorgangstitel in Goobi, für den der Aufruf gestartet wird</td>
    </tr>
    <tr>
      <td style="text-align:left"><code>-t</code>, <code>--jobtype</code>
      </td>
      <td style="text-align:left"><code>IADOWNLOAD</code>
      </td>
      <td style="text-align:left">Der Typ des Jobs</td>
    </tr>
    <tr>
      <td style="text-align:left"><code>-n</code>, <code>--templatename</code>
      </td>
      <td style="text-align:left"><code>template</code>
      </td>
      <td style="text-align:left">Name der zuvor erzeugten Konfigurationsdatei</td>
    </tr>
    <tr>
      <td style="text-align:left"><code>-s</code>, <code>--source</code>
      </td>
      <td style="text-align:left">
        <p><code>http://archive.org/download/</code>
        </p>
        <p><code>${meta.CatalogIDDigital}</code>
        </p>
      </td>
      <td style="text-align:left">Pfad zur URL des Werkes im Internet Archive</td>
    </tr>
    <tr>
      <td style="text-align:left"><code>-d</code>, <code>--destination</code>
      </td>
      <td style="text-align:left"><code>{processpath}</code>
      </td>
      <td style="text-align:left">Pfad zum Hauptverzeichnis des Vorgangs</td>
    </tr>
  </tbody>
</table>## Arbeitsweise des Plugins

Dem Plugin wird eine URL zu einem Band im Internet Archive übergeben. Von dort werden die folgenden Daten in das jeweils übergebene Zielverzeichnis heruntergeladen:

```bash
scandata.xml
marc.xml
abbyy.gz
jp2.zip
```

Schlägt ein Download fehl, wird zunächst die Priorität des Jobs heruntergesetzt und versucht den nächsten Job herunterzuladen. Diese fehlerhaften Versuche werden an Goobi gemeldet und dort im Vorgangslog als Warnung dargestellt.

Jeder Job hat zu Beginn seiner Laufzeit im TaskManager die Priorität 10. Je höher die Priorität, desto eher wird ein Job abgearbeitet. Ist die Priorität eines Jobs bei 0 angelangt, wird der Download noch erneute vier Mal neu versucht. Schlagen alle Versuche des Downloads fehl, wird der Job als fehlerhaft gewertet und mit einer Fehlermeldung an Goobi zurückgesendet.

