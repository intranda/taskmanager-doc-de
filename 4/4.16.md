# 4.16. Plugin: Erstellung eines PDF-Dokumentes für ein gesamtes Werk

Dieses Plugin erstellt ein PDF-Dokument für einen Goobi-Vorgang und speichert es im Dateisystem ab. Für das Inhaltsverzeichnis wird dabei die Struktur der METS-Datei des Goobi-Vorgangs verwendet, für die Seiteninhalte die in der METS-Datei referenzierten Bilddateien.

Je nach Konfiguration können - sofern vorhanden – auch bereits existierende Einzelseiten-PDFs für die Erzeugung des Gesamt-PDFs verwendet werden. Damit geht die Erstellung des PDFs erheblich schneller, da keine Konvertierung stattfinden muss, und Volltexte aus den Einzelseiten-PDFs übernommen werden können.

Alternativ können Volltexte auch aus ALTO-Dokumenten in das PDF geschrieben werden. Dies ist ebenso bei der Erstellung aus Einzelseiten-PDFs möglich, wird jedoch unterdrückt, wenn diese bereits Volltexte beinhalten.

## Aufruf des Plugins

Die Erstellung eines PDFs wird über den TaskClient durch den Aufruf angestoßen:

```bash
/usr/bin/java -jar /opt/digiverso/itm/bin/TaskClient.jar 
    -itm http://localhost:8080/itm/service 
    -s {processpath} 
    -d {processpath}/ocr/{processtitle}_pdf 
    -e 
    -i {stepid} 
    -T {processtitle} 
    -t PdfCreation 
    -n template 
    -gid {processid}
```

## Parameter

Die innerhalb des TaskClient-Aufrufs zu übergebenen Parameter haben folgende Bedeutungen:

<table>
  <thead>
    <tr>
      <th style="text-align:left">Parameter</th>
      <th style="text-align:left">Mögliche Goobi Variable</th>
      <th style="text-align:left">Bedeutung</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align:left"><code>-itm</code>
      </td>
      <td style="text-align:left"><code>http://localhost/itm/service</code>
      </td>
      <td style="text-align:left">URL zur Schnittstelle des intranda TaskManagers</td>
    </tr>
    <tr>
      <td style="text-align:left"><code>-e</code>, <code>--returnError</code>
      </td>
      <td style="text-align:left">-</td>
      <td style="text-align:left">Wenn angegeben, beendet sich der TaskClient mit einem Fehlercode, um das
        automatische Fortschreiten im Workflow zu unterbinden</td>
    </tr>
    <tr>
      <td style="text-align:left"><code>-p</code>
      </td>
      <td style="text-align:left"><code>0 &#x2013; 10</code>
      </td>
      <td style="text-align:left">Priorität zur Verarbeitung dieses Jobs</td>
    </tr>
    <tr>
      <td style="text-align:left"><code>-gid</code>
      </td>
      <td style="text-align:left"><code>{processid}</code>
      </td>
      <td style="text-align:left">ID des Goobi-Vorgangs</td>
    </tr>
    <tr>
      <td style="text-align:left"><code>-i</code>
      </td>
      <td style="text-align:left"><code>{stepid}</code>
      </td>
      <td style="text-align:left">Die ID des Arbeitsschrittes, der den Aufruf startet</td>
    </tr>
    <tr>
      <td style="text-align:left"><code>-T</code>, <code>--title</code>
      </td>
      <td style="text-align:left"><code>{processtitle}</code>
      </td>
      <td style="text-align:left">Der Vorgangstitel in Goobi, für den der Aufruf gestartet wird</td>
    </tr>
    <tr>
      <td style="text-align:left"><code>-t</code>, <code>--jobtype</code>
      </td>
      <td style="text-align:left"><code>PdfCreation</code>
      </td>
      <td style="text-align:left">Der Typ des Jobs</td>
    </tr>
    <tr>
      <td style="text-align:left"><code>-n</code>, <code>--templatename</code>
      </td>
      <td style="text-align:left"><code>template</code>
      </td>
      <td style="text-align:left">Wird in diesem Plugin nicht verwendet.</td>
    </tr>
    <tr>
      <td style="text-align:left"><code>-s</code>, <code>--source</code>
      </td>
      <td style="text-align:left"><code>{processpath}</code>
      </td>
      <td style="text-align:left">Pfad zum Verzeichnis, in dem sich die Datei meta.xml befindet</td>
    </tr>
    <tr>
      <td style="text-align:left"><code>-d</code>, <code>--destination</code>
      </td>
      <td style="text-align:left">
        <p><code>{processpath}/ocr/</code>
        </p>
        <p><code>{processtitle}\_pdf</code>
        </p>
      </td>
      <td style="text-align:left">Pfad zum Ordner, in den das PDF geschrieben werden soll, oder alternativ
        zur PDF-Datei die erstellt werden soll</td>
    </tr>
  </tbody>
</table>Einzelseiten-PDFs und ALTO-Dateien werden aus dem Unterordner `ocr` des source-Ordners - innerhalb dessen sich die Datei `meta.xml` befindet - aus den Unterordnern `<Vorgangsname>_pdf` bzw. `<Vorgangsname>_alto` geladen. Die Dateien müssen, bis auf die Endung, so benannt sein wie die Bilddateien in der METS-Datei.

Ist der Zielordner, in den die PDF-Datei geschrieben wird, identisch mit dem Ordner der Einzelseiten-PDFs, so wird letzterer umbenannt in `<Vorgangsname>_pdf_abbyy`.

## Konfiguration des Plugins

Das Plugin kann ohne eigene Konfigurationsdatei verwendet werden. In diesem Fall werden, sofern vorhanden, Einzelseiten-PDFs und Volltext-ALTO-Dateien für die Erstellung verwendet. Für alle weiteren Parameter der PDF-Erstellung wird die von Goobi bereitgestellte intrandaContentServer Konfigurationsdatei verwendet.

Sollte ein anderes Verhalten gewünscht sein, so muss folgende Konfigurationsdatei angelegt werden:

```bash
/opt/digiverso/itm/config/pdfCreationConfig.xml
```

Diese Datei hat folgenden Inhalt:

```markup
<config_plugin>
    <usePdfDirectory>[true/false]</usePdfDirectory>
    <useAltoDirectory>[true/false]</useAltoDirectory>
    <contentServerConfigPath>
        /path/to/my/content/server/config.xml
    </contentServerConfigPath>
</config_plugin>
```

Mit dem Parameter `usePdfDirectory` lässt sich die Verwendung von Einzelseiten-PDFs an bzw. abschalten; mit dem Parameter `useAltoDirectory` die Verwendung von ALTO-Dateien zur Integrierung von Volltexten.

Der Parameter `contentServerConfigPath` kann verwendet werden, um einen Pfad zu einer alternativen ContentServer-Konfiguration anzugeben, falls ein anderes Verhalten erwünscht ist als für die PDF-Erzeugung in Goobi.

## Stoppen des Plugins

Nach dem Stoppen des Plugins wird eine gerade laufende PDF-Erzeugung beendet, bevor das Plugin beendet wird. In der Warteschlange verbleibende Jobs werden anschließend nach dem Neustart des Plugins bearbeitet.

Die Erzeugung des PDFs erfolgt im TaskManager-Plugin. Beendet man also den TaskManager selbst, wird die Erzeugung sofort abgebrochen. Der Job ist dann jedoch weder in der Warteliste, noch gilt er als beendet oder abgebrochen. Der Job muss in diesem Fall manuell abgebrochen und erneut gestartet werden.

